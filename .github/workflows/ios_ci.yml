name: KMP iOS Build CI

# 언제 이 빌드를 실행할지 결정합니다.
on:
  push:
    branches: [ "main", "develop" ] # main이나 develop 브랜치에 코드가 올라갈 때
  pull_request:
    branches: [ "main", "develop" ]

jobs:
  build-ios:
    # 가장 핵심! GitHub이 제공하는 최신 macOS 환경을 대여해서 사용합니다.
    runs-on: macos-latest 

    steps:
      # 1. 깃허브 저장소의 내 코드를 Mac 가상 머신으로 가져옵니다.
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. Gradle 빌드에 필요한 Java 환경을 세팅합니다. (버전은 본인 프로젝트에 맞게 수정)
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'zulu'

      # 3. Gradle 캐싱을 설정하여 다음 빌드 속도를 높입니다.
      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v3

      # 4. KMP iOS 프레임워크 빌드하기
      - name: Build KMP iOS framework
        run: ./gradlew :composeApp:linkDebugFrameworkIosSimulatorArm64

      # 5. (선택) UI까지 포함된 실제 iOS 앱(Xcode 프로젝트) 빌드 테스트
      # Xcode 프로젝트 폴더 이름(iosApp 등)과 Scheme을 확인하세요.
      - name: Build iOS App with Xcode
        run: |
          xcodebuild -workspace iosApp/iosApp.xcworkspace \
                     -scheme iosApp \
                     -configuration Debug \
                     -sdk iphonesimulator \
                     -destination 'platform=iOS Simulator,name=iPhone 15,OS=latest' \
                     build